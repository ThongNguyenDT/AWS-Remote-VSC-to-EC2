<!DOCTYPE html>
<html lang="vi" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.132.0">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/images/favicon.png" type="image/png">

    <title>Tạo VSCode từ bản dựng AMI từ EC2 Image Builder :: AWS System Manager</title>

    
    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/css/nucleus.css?1723573434" rel="stylesheet">
    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/css/fontawesome-all.min.css?1723573434" rel="stylesheet">
    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/css/hybrid.css?1723573434" rel="stylesheet">
    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/css/featherlight.min.css?1723573434" rel="stylesheet">
    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/css/perfect-scrollbar.min.css?1723573434" rel="stylesheet">
    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/css/auto-complete.css?1723573434" rel="stylesheet">
    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/css/atom-one-dark-reasonable.css?1723573434" rel="stylesheet">
    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/css/theme.css?1723573434" rel="stylesheet">
    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/css/hugo-theme.css?1723573434" rel="stylesheet">
    
    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/css/theme-workshop.css?1723573434" rel="stylesheet">
    
    

    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/jquery-3.3.1.min.js?1723573434"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/6-generate-vscode-from-ami-build-from-ec2-image-builder/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/lunr.min.js?1723573434"></script>
<script type="text/javascript" src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/auto-complete.js?1723573434"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/levuxuanan.github.io\/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2\/\/vi";
    
</script>
<script type="text/javascript" src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/search.js?1723573434"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/1-connect-vscode-to-aws-ec2-using-ssh/" title="Kết nối VSCode với AWS EC2 bằng SSH" class="dd-item 
        
        
        
        ">
      <a href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/1-connect-vscode-to-aws-ec2-using-ssh/">
           <b> 1. </b> Kết nối VSCode với AWS EC2 bằng SSH
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/2-connect-vscode-to-aws-ec2-using-zerotier/" title="kết nối VSCode với AWS EC2 bằng Zerotier" class="dd-item 
        
        
        
        ">
      <a href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/2-connect-vscode-to-aws-ec2-using-zerotier/">
           <b> 2. </b> kết nối VSCode với AWS EC2 bằng Zerotier
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/3-hosting-vs-code-on-ec2-from-amazon-linux-2/" title="Hosting VS Code trên EC2 từ Amazon Linux 2" class="dd-item 
        
        
        
        ">
      <a href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/3-hosting-vs-code-on-ec2-from-amazon-linux-2/">
           <b> 3. </b> Hosting VS Code trên EC2 từ Amazon Linux 2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/4-manually-deploy-vs-code-on-ec2/" title="Triển khai thủ công VS Code trên EC2" class="dd-item 
        
        
        
        ">
      <a href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/4-manually-deploy-vs-code-on-ec2/">
           <b> 4. </b> Triển khai thủ công VS Code trên EC2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/5-extended-create-an-ami-from-an-instance-and-run-an-instance-from-that-ami/" title="Tạo AMI từ instance và chạy instance từ AMI đó" class="dd-item 
        
        
        
        ">
      <a href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/5-extended-create-an-ami-from-an-instance-and-run-an-instance-from-that-ami/">
           <b> 5. </b> Tạo AMI từ instance và chạy instance từ AMI đó
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/6-generate-vscode-from-ami-build-from-ec2-image-builder/" title="Tạo VSCode từ bản dựng AMI từ EC2 Image Builder" class="dd-item 
        
        active
        
        ">
      <a href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/6-generate-vscode-from-ami-build-from-ec2-image-builder/">
           <b> 6. </b> Tạo VSCode từ bản dựng AMI từ EC2 Image Builder
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/7-connect-vscode-using-ec2_instances_connect-and-aws-systems-manager/" title="Kết nối VScode bằng EC2_Instances_Connect và AWS Systems Manager" class="dd-item 
        
        
        
        ">
      <a href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/7-connect-vscode-using-ec2_instances_connect-and-aws-systems-manager/">
           <b> 7. </b> Kết nối VScode bằng EC2_Instances_Connect và AWS Systems Manager
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="https://levuxuanan.github.io/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/6-generate-vscode-from-ami-build-from-ec2-image-builder/">English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="https://levuxuanan.github.io/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/6-generate-vscode-from-ami-build-from-ec2-image-builder/" selected>Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
    <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0"
        title="Migrate" Alt="web counter" border="0" /></a> <br>
    <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0"
        title="Total Cloud Journey" Alt="web counter" border="0" />

</left>
<left>
    <br>
    <br>
    <b> Last Updated </b> <br>
    <i>
        <font color=orange>11-08-2024</font>
    </i>
</left>
<left>
    <br>
    <br>
    <b> Author</b> <br>

    <i> <a href="#" style="color:orange">Tien Thong</a> <br>
        <a href="https://www.linkedin.com/in/levuxuanan/" style="color:orange">Xuan An</a> <br>
        <a href="https://www.linkedin.com/in/anh-p-47063a13a/" style="color:orange">Hai An</a> <br>
    </i>
</left>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/'>REMOTE DEVELOPMENT WITH VS VSCODE AND EC2</a> > Tạo VSCode từ bản dựng AMI từ EC2 Image Builder
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#61-thuật-ngữ">6.1. Thuật ngữ</a>
      <ul>
        <li><a href="#621-ami">6.2.1. AMI</a></li>
        <li><a href="#622-image-pipeline">6.2.2. Image Pipeline</a></li>
        <li><a href="#623-image-recipe">6.2.3. Image Recipe</a></li>
        <li><a href="#624-source-image">6.2.4. Source Image</a></li>
        <li><a href="#625-build-components">6.2.5. Build Components</a></li>
      </ul>
    </li>
    <li><a href="#62-triển-khai">6.2. Triển khai</a>
      <ul>
        <li><a href="#621-tạo-component">6.2.1. Tạo Component</a></li>
        <li><a href="#bước-1-truy-cập-components-consolehttpsus-east-1consoleawsamazoncomimagebuilderhomeregionus-east-1components-click-create-component">Bước 1: Truy cập <a href="https://us-east-1.console.aws.amazon.com/imagebuilder/home?region=us-east-1#/components">Components console</a>. Click Create component.</a></li>
        <li><a href="#bước-2-chọn-type-là-build">Bước 2: Chọn Type là <code>Build</code>.</a></li>
        <li><a href="#bước-3-chọn-các-giá-trị-theo-danh-sách-sau">Bước 3: Chọn các giá trị theo danh sách sau</a></li>
        <li><a href="#bước-4-mục-definition-document-phần-content-copy-nội-dung-sau-vào">Bước 4: Mục Definition document, phần Content, copy nội dung sau vào:</a></li>
        <li><a href="#bước-5-chọn-create-component">Bước 5: Chọn “Create Component”.</a></li>
        <li><a href="#bước-6-phụ-tạo-version-mới-bằng-cách-chọn-action--create-new-version">Bước 6 (Phụ): Tạo version mới bằng cách chọn Action → Create new version.</a></li>
        <li><a href="#622-tạo-role-cho-ec2-image-builder">6.2.2. Tạo role cho EC2 Image Builder</a></li>
        <li><a href="#bước-1-chọn-aws-service--use-case-ec2">Bước 1: Chọn <code>AWS service</code> , use case <code>EC2</code></a></li>
        <li><a href="#bước-2-thêm-các-policy-như-hình-sau">Bước 2: Thêm các policy như hình sau</a></li>
        <li><a href="#bước-3-đặt-tên-role-là-ec2imagebuilderinfraconfigrole-và-mô-tả">Bước 3: Đặt tên Role là <code>EC2ImageBuilderInfraConfigRole</code> và mô tả</a></li>
        <li><a href="#623-tạo-pipeline">6.2.3. Tạo pipeline</a></li>
        <li><a href="#bước-1-truy-cập-pipeline-consolehttpsus-east-1consoleawsamazoncomimagebuilderhomeregionus-east-1createpipeline">Bước 1: Truy cập <a href="https://us-east-1.console.aws.amazon.com/imagebuilder/home?region=us-east-1#/createPipeline">pipeline console</a>.</a></li>
        <li><a href="#bước-2-đặt-tên-cho-pipeline-là-vsc-pipeline--mô-tả-tùy-ý">Bước 2: Đặt tên cho pipeline là <code>VSC-Pipeline</code> . Mô tả tùy ý.</a></li>
        <li><a href="#bước-3-mục-build-schedule-chọn-manual-rồi-chọn-next">Bước 3: Mục Build schedule, chọn <code>Manual</code> rồi chọn Next.</a></li>
        <li><a href="#bước-4-mục-recipe-chọn-create-new-recipe--mục-image-type-chọn-ami">Bước 4: Mục Recipe, chọn <code>Create new recipe</code> . Mục Image type chọn <code>AMI</code></a></li>
        <li><a href="#bước-5-mục-general-đặt-tên-cho-ami-và-phiên-bản">Bước 5: Mục General, đặt tên cho ami và phiên bản</a></li>
        <li><a href="#bước-6-mục-base-image-chọn-select-managed-images-và-amazon-linux">Bước 6: Mục Base image, chọn <code>Select managed images</code> và <code>Amazon Linux</code></a></li>
        <li><a href="#bước-7-tại-image-origin-chọn-quick-start--tại-image-name-chọn-amazon-linux-2023-x86--chọn-version-tương-thích-hiện-tại-chọn-use-latest-available-os-version">Bước 7: Tại Image origin, chọn <code>Quick start</code> . Tại Image name, chọn <code>Amazon Linux 2023 x86</code> . Chọn version tương thích, hiện tại chọn <code>Use latest available OS version</code></a></li>
        <li><a href="#bước-8-tại-working-directory-gõ-homeec2-user-vì-sẽ-tải-nvm-vào-thư-mục-home-của-user-thực-thi-là-ec2-user">Bước 8: Tại Working directory, gõ <code>/home/ec2-user</code> vì sẽ tải nvm vào thư mục home của user thực thi là ec2-user.</a></li>
        <li><a href="#bước-9-tại-filter-owner-mục-components-chọn-ô-owned-by-me-chọn-component-đã-tạo">Bước 9: Tại <code>Filter owner</code> mục Components, chọn ô <code>Owned by me</code>. Chọn component đã tạo.</a></li>
        <li><a href="#bước-10-để-mặc-định-phần-storage-rồi-next">Bước 10: Để mặc định phần Storage rồi Next.</a></li>
        <li><a href="#bước-11-mục-define-image-creation-process-chọn-next">Bước 11: Mục Define image creation process, chọn Next.</a></li>
        <li><a href="#bước-12-mục-infrastructure-configuration-chọn-create-a-new-infrastructure-configuration-đặt-tên-là-vsc-infraconfig--chọn-iam-role-đã-tạo">Bước 12: Mục Infrastructure configuration, chọn <code>Create a new infrastructure configuration</code>. Đặt tên là <code>VSC-InfraConfig</code> . Chọn IAM role đã tạo.</a></li>
        <li><a href="#bước-13-mở-rộng-mục-vpc-subnet-and-security-groups-chọn-instance-type-là-t3medium--vpc-là-vsc-đã-tạo-ở-phần-4-chọn-1-trong-2-private-subnet-chọn-security-group-có-từ-vsc-security-không-inbound-rule-của-phần-trước-để-có-thể-tạo-và-đánh-giá-instance-chọn-next">Bước 13: Mở rộng mục VPC, subnet and security groups. Chọn instance type là <code>t3.medium</code> , VPC là <code>VSC</code> (đã tạo ở Phần 4), chọn 1 trong 2 <code>private subnet</code>, chọn security group có từ <code>VSC</code> (security không inbound rule của phần trước) để có thể tạo và đánh giá instance. Chọn Next.</a></li>
        <li><a href="#bước-14-mục-distribution-settings-để-default-rồi-next">Bước 14: Mục distribution settings để default rồi Next.</a></li>
        <li><a href="#bước-15-sau-khi-review-chọn-create-pipeline">Bước 15: Sau khi review, chọn Create pipeline.</a></li>
      </ul>
    </li>
    <li><a href="#63-tạo-instance-từ-ami-dựng-từ-pipeline">6.3. Tạo instance từ AMI dựng từ pipeline</a>
      <ul>
        <li><a href="#631-tạo-ami-từ-pipline">6.3.1. Tạo AMI từ pipline</a></li>
        <li><a href="#bước-1-chọn-pipeline-vừa-tạo-ô-action-chọn-run-pipeline">Bước 1: Chọn pipeline vừa tạo. Ô Action, chọn Run pipeline:</a></li>
        <li><a href="#bước-2-bấm-view-details-để-theo-dõi-chi-tiết">Bước 2: Bấm <code>View details</code> để theo dõi chi tiết:</a></li>
        <li><a href="#bước-3-chọn-link-log-stream-để-theo-dõi-cloudwatch-log-stream-của-pipeline">Bước 3: Chọn link log stream để theo dõi CloudWatch log stream của pipeline</a></li>
        <li><a href="#bước-4-quay-lại-pipeline-đang-chạy-khi-build-ami-xong-image-status-đổi-thành-available-click-vào-phiên-bản-image-đã-tạo-hình-dưới-là-1041">Bước 4: Quay lại pipeline đang chạy. Khi build ami xong, image status đổi thành Available. Click vào phiên bản image đã tạo (hình dưới là 1.0.4/1):</a></li>
        <li><a href="#bước-5-quan-sát-image-đã-tạo-từ-ec2-image-builder-bấm-vào-link-ami">Bước 5: Quan sát image đã tạo từ EC2 Image Builder. Bấm vào link AMI:</a></li>
        <li><a href="#bước-6-quan-sát-ami-từ-trang-ec2">Bước 6: Quan sát ami từ trang EC2</a></li>
        <li><a href="#632-tạo-instance-từ-ami-vừa-tạo">6.3.2. Tạo instance từ AMI vừa tạo</a></li>
        <li><a href="#bước-1-vào-trang-ami-của-ec2-console-chọn-ami-vừa-tạo-click-launch-instance-from-ami">Bước 1: Vào trang AMI của EC2 console. Chọn ami vừa tạo. Click <code>Launch instance from AMI</code></a></li>
        <li><a href="#bước-2-chọn-instance-type-để-tiết-kiệm-thì-chọn-t2micro-">Bước 2: Chọn instance type. Để tiết kiệm thì chọn <code>t2.micro</code> .</a></li>
        <li><a href="#bước-3-không-cần-key-pair">Bước 3: Không cần key pair.</a></li>
        <li><a href="#bước-4-chọn-vpc-và-security-group-có-từ-vsc--private-subnet-đảm-bảo-không-có-public-ip">Bước 4: Chọn VPC và security group có từ <code>VSC</code> , private subnet, đảm bảo không có public IP</a></li>
        <li><a href="#bước-5-cung-cấp-iam-instance-profile-có-từ-vsc-để-cài-đặt-ssm-agent">Bước 5: Cung cấp IAM instance profile có từ <code>VSC</code> để cài đặt SSM agent</a></li>
        <li><a href="#bước-6-chọn-create-instance">Bước 6: Chọn <code>Create instance</code></a></li>
        <li><a href="#bước-7-đợi-tới-khi-instance-status-available">Bước 7: Đợi tới khi instance status <code>Available</code></a></li>
        <li><a href="#bước-8-truy-cập-web-app-vscode-bằng-session-manager-qua-port-forwarding">Bước 8: Truy cập web app VSCode bằng Session Manager qua port forwarding</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Tạo VSCode từ bản dựng AMI từ EC2 Image Builder
            </h1>
          

        



	<p>C2 Image Builder giúp tự động hóa việc tạo, quản lý và triển khai các ami “golden” được tùy chỉnh, an toàn và cập nhật được cài đặt sẵn và cấu hình sẵn bằng phần mềm và cài đặt.</p>
<p>Phần này ta sẽ xây dựng một AMI cũng như phần 5, nhưng bằng cách dùng EC2 Image Builder để tạo ra một quy trình image pipeline từ khâu cấu hình hạ tầng (OS, VPC, subnet, security group), IAM instance profile, tới việc cài đặt cho ami, triển khai thành instance và test trạng thái instance đó, đồng thời scan lỗ hổng bảo mật trong ami.</p>
<p>Tham khảo: <a href="https://catalog.us-east-1.prod.workshops.aws/workshops/d6c7ecdc-c75f-4ad1-910f-fdd994cc4aed/en-US">AWS for Microsoft Workloads Immersion Day (workshops.aws)</a></p>
<h2 id="61-thuật-ngữ">6.1. Thuật ngữ</h2>
<h3 id="621-ami">6.2.1. AMI</h3>
<p>Đơn vị triển khai cơ bản trong Amazon EC2. AMI là VM image được cấu hình sẵn có chứa hệ điều hành và phần mềm được cài đặt sẵn để triển khai các phiên bản EC2.</p>
<h3 id="622-image-pipeline">6.2.2. Image Pipeline</h3>
<p>Cấu hình tự động để xây dựng hình ảnh hệ điều hành an toàn trên AWS. Image Builder pipeline được liên kết với một <strong>image recipe</strong> xác định các giai đoạn xây dựng (build), xác thực (validation) và thử nghiệm (test) cho vòng đời xây dựng image. Image pipeline có thể được liên kết với infrastructure configuration nhằm định nghĩa nơi image được xây dựng (build). Bạn có thể xác định các thuộc tính, chẳng hạn như <em>version</em>*,** subnet, security groups*, <em>logging</em> và các cấu hình khác liên quan đến cơ sở hạ tầng.</p>
<h3 id="623-image-recipe">6.2.3. Image Recipe</h3>
<p>Image recipe là một tài liệu (document) xác định <em>source image</em> và các thành phần sẽ được áp dụng cho <em>source image</em> để tạo cấu hình mong muốn cho hình ảnh đầu ra. Bạn có thể sử dụng image recipe để sao chép các bản dựng (build). Image Builder recipe có thể được chia sẻ, phân nhánh và chỉnh sửa bằng console, AWS CLI hoặc API.</p>
<h3 id="624-source-image">6.2.4. Source Image</h3>
<p>Image đã chọn và hệ điều hành được sử dụng trong <em>image recipe document</em> của bạn cùng với các thành phần. Ảnh nguồn và định nghĩa thành phần kết hợp tạo ra cấu hình mong muốn cho <em>output image.</em></p>
<h3 id="625-build-components">6.2.5. Build Components</h3>
<p>Tài liệu dàn dựng (orchestration documents) xác định trình tự các bước để tải xuống, cài đặt và cấu hình các gói phần mềm. Chúng cũng xác định các bước xác thực và tăng cường bảo mật. Một thành phần được xác định bằng định dạng tài liệu YAML.</p>
<h2 id="62-triển-khai">6.2. Triển khai</h2>
<h3 id="621-tạo-component">6.2.1. Tạo Component</h3>
<h3 id="bước-1-truy-cập-components-consolehttpsus-east-1consoleawsamazoncomimagebuilderhomeregionus-east-1components-click-create-component">Bước 1: Truy cập <a href="https://us-east-1.console.aws.amazon.com/imagebuilder/home?region=us-east-1#/components">Components console</a>. Click Create component.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.1-step1.png"></p>
<h3 id="bước-2-chọn-type-là-build">Bước 2: Chọn Type là <code>Build</code>.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.1-step2.png"></p>
<h3 id="bước-3-chọn-các-giá-trị-theo-danh-sách-sau">Bước 3: Chọn các giá trị theo danh sách sau</h3>
<ul>
<li>OS: Linux</li>
<li>Compatible OS Versions: Amazon Linux 2023</li>
<li>Component name: VSC-Component</li>
<li>Component version: 1.0.0</li>
</ul>
<p><img alt="Untitled" src="/images/part6/6.2.1-step3.png"></p>
<h3 id="bước-4-mục-definition-document-phần-content-copy-nội-dung-sau-vào">Bước 4: Mục Definition document, phần Content, copy nội dung sau vào:</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">HelloWorldTestingDocument</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">description</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">This</span> <span style="color:#a6e22e">is</span> <span style="color:#a6e22e">hello</span> <span style="color:#a6e22e">world</span> <span style="color:#a6e22e">testing</span> document.
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">schemaVersion</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">1.0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">phases</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">build</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">steps</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">HostingVSCode</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">action</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ExecuteBash</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">inputs</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">commands</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">-</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>              <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#f92672">!</span><span style="color:#960050;background-color:#1e0010">/bin/bash</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">rpm</span> <span style="color:#f92672">--</span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//packages.microsoft.com/keys/microsoft.asc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">sh</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">c</span> <span style="color:#e6db74">&#39;echo -e &#34;[code]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              name=Visual Studio Code
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              baseurl=https://packages.microsoft.com/yumrepos/vscode
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              enabled=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              gpgcheck=1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              gpgkey=https://packages.microsoft.com/keys/microsoft.asc&#34; &gt; /etc/yum.repos.d/vscode.repo&#39;</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>              <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//github.com/amazonlinux/amazon-linux-2023/issues/397
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#a6e22e">sleep</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>              
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">yum</span> <span style="color:#a6e22e">install</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">y</span> <span style="color:#a6e22e">code</span> <span style="color:#a6e22e">git</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">tee</span> <span style="color:#f92672">/</span><span style="color:#a6e22e">etc</span><span style="color:#f92672">/</span><span style="color:#a6e22e">systemd</span><span style="color:#f92672">/</span><span style="color:#a6e22e">system</span><span style="color:#f92672">/</span><span style="color:#a6e22e">code</span><span style="color:#f92672">-</span><span style="color:#a6e22e">server</span>.<span style="color:#a6e22e">service</span> <span style="color:#f92672">&lt;&lt;</span><span style="color:#a6e22e">EOF</span>
</span></span><span style="display:flex;"><span>              [<span style="color:#a6e22e">Unit</span>]
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">Description</span><span style="color:#f92672">=</span><span style="color:#a6e22e">Start</span> <span style="color:#a6e22e">code</span> <span style="color:#a6e22e">server</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>              [<span style="color:#a6e22e">Service</span>]
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">ExecStart</span><span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">/usr/bin/code serve-web --port 8080 --host 0.0.0.0 --without-connection-token</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">Restart</span><span style="color:#f92672">=</span><span style="color:#a6e22e">always</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">Type</span><span style="color:#f92672">=</span><span style="color:#a6e22e">simple</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">User</span><span style="color:#f92672">=</span><span style="color:#a6e22e">ec2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">user</span>
</span></span><span style="display:flex;"><span>              
</span></span><span style="display:flex;"><span>              [<span style="color:#a6e22e">Install</span>]
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">WantedBy</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">multi</span><span style="color:#f92672">-</span><span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">target</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">EOF</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">systemctl</span> <span style="color:#a6e22e">daemon</span><span style="color:#f92672">-</span><span style="color:#a6e22e">reload</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">systemctl</span> <span style="color:#a6e22e">enable</span> <span style="color:#f92672">--</span><span style="color:#a6e22e">now</span> <span style="color:#a6e22e">code</span><span style="color:#f92672">-</span><span style="color:#a6e22e">server</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>              <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">Install</span> <span style="color:#a6e22e">Node</span>.<span style="color:#a6e22e">js</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">sudo</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">u</span> <span style="color:#a6e22e">ec2</span><span style="color:#f92672">-</span><span style="color:#a6e22e">user</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;&lt;</span><span style="color:#a6e22e">EOF</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">curl</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">o</span><span style="color:#f92672">-</span> <span style="color:#a6e22e">https</span><span style="color:#f92672">:</span><span style="color:#75715e">//raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>              <span style="color:#a6e22e">source</span> .<span style="color:#a6e22e">bashrc</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">nvm</span> <span style="color:#a6e22e">install</span> <span style="color:#ae81ff">20.11.0</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">nvm</span> <span style="color:#a6e22e">use</span> <span style="color:#ae81ff">20.11.0</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">EOF</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">validate</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">steps</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">VSCodeValidate</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">action</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ExecuteBash</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">inputs</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">commands</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">-</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>              <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#f92672">!</span><span style="color:#960050;background-color:#1e0010">/bin/bash</span>
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span> <span style="color:#a6e22e">command</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">v</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">&amp;&gt;</span> <span style="color:#960050;background-color:#1e0010">/dev/null</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">echo</span> <span style="color:#e6db74">&#34;code could not be found&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">exit</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">validate</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">steps</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">NodeJSValidate</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">action</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ExecuteBash</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">inputs</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">commands</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">-</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>              <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#f92672">!</span><span style="color:#960050;background-color:#1e0010">/bin/bash</span>
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span> <span style="color:#a6e22e">command</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">v</span> <span style="color:#a6e22e">node</span> <span style="color:#f92672">&amp;&gt;</span> <span style="color:#960050;background-color:#1e0010">/dev/null</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">echo</span> <span style="color:#e6db74">&#34;Node could not be found&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">exit</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">fi</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">steps</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">-</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">TestWhetherAppDeploy</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">action</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ExecuteBash</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">inputs</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">commands</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">-</span> <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>              <span style="color:#960050;background-color:#1e0010">#</span><span style="color:#f92672">!</span><span style="color:#960050;background-color:#1e0010">/bin/bash</span>
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> <span style="color:#f92672">!</span> <span style="color:#a6e22e">sudo</span> <span style="color:#a6e22e">lsof</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">i</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">n</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">P</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">grep</span> <span style="color:#ae81ff">8080</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">grep</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">w</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">&amp;&gt;</span> <span style="color:#960050;background-color:#1e0010">/dev/null</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">then</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">echo</span> <span style="color:#e6db74">&#34;App could not be found&#34;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">exit</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">fi</span>
</span></span></code></pre></div><p>Nội dung document này gồm 3 phần:</p>
<ul>
<li>Build: Dựa trên user-data của phần trước. Cài đặt VS Code dạng web app lắng nghe ở port 8080.</li>
<li>Validation: Kiểm tra liệu đã cài thành công NodeJS và VS Code</li>
<li>Test: Kiểm tra liệu web app có tồn tại và lắng nghe ở port 8080</li>
</ul>
<h3 id="bước-5-chọn-create-component">Bước 5: Chọn “Create Component”.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.1-step5-1.png"></p>
<p>Kết quả:</p>
<p><img alt="Untitled" src="/images/part6/6.2.1-step5-2.png"></p>
<h3 id="bước-6-phụ-tạo-version-mới-bằng-cách-chọn-action--create-new-version">Bước 6 (Phụ): Tạo version mới bằng cách chọn Action → Create new version.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.1-step6.png"></p>
<p>Chỉ cần đổi nội dung mục content và sửa lại giá trị mục Component version rồi chọn Create component</p>
<h3 id="622-tạo-role-cho-ec2-image-builder">6.2.2. Tạo role cho EC2 Image Builder</h3>
<h3 id="bước-1-chọn-aws-service--use-case-ec2">Bước 1: Chọn <code>AWS service</code> , use case <code>EC2</code></h3>
<p><img alt="Untitled" src="/images/part6/6.2.2-step1.png"></p>
<h3 id="bước-2-thêm-các-policy-như-hình-sau">Bước 2: Thêm các policy như hình sau</h3>
<p><img alt="Untitled" src="/images/part6/6.2.2-step2.png"></p>
<h3 id="bước-3-đặt-tên-role-là-ec2imagebuilderinfraconfigrole-và-mô-tả">Bước 3: Đặt tên Role là <code>EC2ImageBuilderInfraConfigRole</code> và mô tả</h3>
<p><img alt="Untitled" src="/images/part6/6.2.2-step3.png"></p>
<h3 id="623-tạo-pipeline">6.2.3. Tạo pipeline</h3>
<h3 id="bước-1-truy-cập-pipeline-consolehttpsus-east-1consoleawsamazoncomimagebuilderhomeregionus-east-1createpipeline">Bước 1: Truy cập <a href="https://us-east-1.console.aws.amazon.com/imagebuilder/home?region=us-east-1#/createPipeline">pipeline console</a>.</h3>
<h3 id="bước-2-đặt-tên-cho-pipeline-là-vsc-pipeline--mô-tả-tùy-ý">Bước 2: Đặt tên cho pipeline là <code>VSC-Pipeline</code> . Mô tả tùy ý.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step2.png"></p>
<p>Có thể chọn thêm các option <code>Enable EC2 image scanning</code> để đảm bảo ami bảo mật.</p>
<h3 id="bước-3-mục-build-schedule-chọn-manual-rồi-chọn-next">Bước 3: Mục Build schedule, chọn <code>Manual</code> rồi chọn Next.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step3.png"></p>
<h3 id="bước-4-mục-recipe-chọn-create-new-recipe--mục-image-type-chọn-ami">Bước 4: Mục Recipe, chọn <code>Create new recipe</code> . Mục Image type chọn <code>AMI</code></h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step4.png"></p>
<h3 id="bước-5-mục-general-đặt-tên-cho-ami-và-phiên-bản">Bước 5: Mục General, đặt tên cho ami và phiên bản</h3>
<h3 id="bước-6-mục-base-image-chọn-select-managed-images-và-amazon-linux">Bước 6: Mục Base image, chọn <code>Select managed images</code> và <code>Amazon Linux</code></h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step6.png"></p>
<h3 id="bước-7-tại-image-origin-chọn-quick-start--tại-image-name-chọn-amazon-linux-2023-x86--chọn-version-tương-thích-hiện-tại-chọn-use-latest-available-os-version">Bước 7: Tại Image origin, chọn <code>Quick start</code> . Tại Image name, chọn <code>Amazon Linux 2023 x86</code> . Chọn version tương thích, hiện tại chọn <code>Use latest available OS version</code></h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step7.png"></p>
<h3 id="bước-8-tại-working-directory-gõ-homeec2-user-vì-sẽ-tải-nvm-vào-thư-mục-home-của-user-thực-thi-là-ec2-user">Bước 8: Tại Working directory, gõ <code>/home/ec2-user</code> vì sẽ tải nvm vào thư mục home của user thực thi là ec2-user.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step8.png"></p>
<h3 id="bước-9-tại-filter-owner-mục-components-chọn-ô-owned-by-me-chọn-component-đã-tạo">Bước 9: Tại <code>Filter owner</code> mục Components, chọn ô <code>Owned by me</code>. Chọn component đã tạo.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step9-1.png"></p>
<p>Trong hình là phiên bản 1.0.1, vì đã làm thêm bước tạo version mới ở phần trước (nội dung component không đổi).</p>
<p>Mục Test components - Amazon Linux, với mục đích demo, chọn <code>reboot-test-linux</code> .</p>
<p><img alt="Untitled" src="/images/part6/6.2.3-step9-1.png"></p>
<h3 id="bước-10-để-mặc-định-phần-storage-rồi-next">Bước 10: Để mặc định phần Storage rồi Next.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step10.png"></p>
<h3 id="bước-11-mục-define-image-creation-process-chọn-next">Bước 11: Mục Define image creation process, chọn Next.</h3>
<h3 id="bước-12-mục-infrastructure-configuration-chọn-create-a-new-infrastructure-configuration-đặt-tên-là-vsc-infraconfig--chọn-iam-role-đã-tạo">Bước 12: Mục Infrastructure configuration, chọn <code>Create a new infrastructure configuration</code>. Đặt tên là <code>VSC-InfraConfig</code> . Chọn IAM role đã tạo.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step12.png"></p>
<h3 id="bước-13-mở-rộng-mục-vpc-subnet-and-security-groups-chọn-instance-type-là-t3medium--vpc-là-vsc-đã-tạo-ở-phần-4-chọn-1-trong-2-private-subnet-chọn-security-group-có-từ-vsc-security-không-inbound-rule-của-phần-trước-để-có-thể-tạo-và-đánh-giá-instance-chọn-next">Bước 13: Mở rộng mục VPC, subnet and security groups. Chọn instance type là <code>t3.medium</code> , VPC là <code>VSC</code> (đã tạo ở Phần 4), chọn 1 trong 2 <code>private subnet</code>, chọn security group có từ <code>VSC</code> (security không inbound rule của phần trước) để có thể tạo và đánh giá instance. Chọn Next.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step13-1.png"></p>
<p>Nhắc lại về security group outbound rules:</p>
<p><img alt="Untitled" src="/images/part6/6.2.3-step13-2.png"></p>
<h3 id="bước-14-mục-distribution-settings-để-default-rồi-next">Bước 14: Mục distribution settings để default rồi Next.</h3>
<p><img alt="Untitled" src="/images/part6/6.2.3-step14.png"></p>
<h3 id="bước-15-sau-khi-review-chọn-create-pipeline">Bước 15: Sau khi review, chọn Create pipeline.</h3>
<h2 id="63-tạo-instance-từ-ami-dựng-từ-pipeline">6.3. Tạo instance từ AMI dựng từ pipeline</h2>
<h3 id="631-tạo-ami-từ-pipline">6.3.1. Tạo AMI từ pipline</h3>
<h3 id="bước-1-chọn-pipeline-vừa-tạo-ô-action-chọn-run-pipeline">Bước 1: Chọn pipeline vừa tạo. Ô Action, chọn Run pipeline:</h3>
<p><img alt="Untitled" src="/images/part6/6.3.1.-step1-1.png"></p>
<p>Thông báo màu xanh hiện ra.</p>
<p><img alt="Untitled" src="/images/part6/6.3.1.-step1-2.png"></p>
<h3 id="bước-2-bấm-view-details-để-theo-dõi-chi-tiết">Bước 2: Bấm <code>View details</code> để theo dõi chi tiết:</h3>
<p><img alt="Untitled" src="/images/part6/6.3.1.-step2.png"></p>
<p>Thấy Image status là Testing.</p>
<h3 id="bước-3-chọn-link-log-stream-để-theo-dõi-cloudwatch-log-stream-của-pipeline">Bước 3: Chọn link log stream để theo dõi CloudWatch log stream của pipeline</h3>
<p>Phase test, step <code>TestWhetherAppDeploy</code>:</p>
<p><img alt="Untitled" src="/images/part6/6.3.1.-step3-1.png"></p>
<p>Phase <code>RebootTest</code> :</p>
<p><img alt="Untitled" src="/images/part6/6.3.1.-step3-2.png"></p>
<p>Nếu lỗi thì exit code 1, không lỗi thì exit code 0. Sau cùng, instance test không lỗi.</p>
<h3 id="bước-4-quay-lại-pipeline-đang-chạy-khi-build-ami-xong-image-status-đổi-thành-available-click-vào-phiên-bản-image-đã-tạo-hình-dưới-là-1041">Bước 4: Quay lại pipeline đang chạy. Khi build ami xong, image status đổi thành Available. Click vào phiên bản image đã tạo (hình dưới là 1.0.4/1):</h3>
<p><img alt="Untitled" src="/images/part6/6.3.1.-step4.png"></p>
<h3 id="bước-5-quan-sát-image-đã-tạo-từ-ec2-image-builder-bấm-vào-link-ami">Bước 5: Quan sát image đã tạo từ EC2 Image Builder. Bấm vào link AMI:</h3>
<p><img alt="Untitled" src="/images/part6/6.3.1.-step5.png"></p>
<h3 id="bước-6-quan-sát-ami-từ-trang-ec2">Bước 6: Quan sát ami từ trang EC2</h3>
<p><img alt="Untitled" src="/images/part6/6.3.1.-6.png"></p>
<p>AMI đã tạo thành công, và đã trải qua các test trong quá trình pipeline mà không phát sinh lỗi.</p>
<h3 id="632-tạo-instance-từ-ami-vừa-tạo">6.3.2. Tạo instance từ AMI vừa tạo</h3>
<h3 id="bước-1-vào-trang-ami-của-ec2-console-chọn-ami-vừa-tạo-click-launch-instance-from-ami">Bước 1: Vào trang AMI của EC2 console. Chọn ami vừa tạo. Click <code>Launch instance from AMI</code></h3>
<p><img alt="Untitled" src="/images/part6/6.3.2.-step1.png"></p>
<h3 id="bước-2-chọn-instance-type-để-tiết-kiệm-thì-chọn-t2micro-">Bước 2: Chọn instance type. Để tiết kiệm thì chọn <code>t2.micro</code> .</h3>
<h3 id="bước-3-không-cần-key-pair">Bước 3: Không cần key pair.</h3>
<p><img alt="Untitled" src="/images/part6/6.3.2.-step3.png"></p>
<h3 id="bước-4-chọn-vpc-và-security-group-có-từ-vsc--private-subnet-đảm-bảo-không-có-public-ip">Bước 4: Chọn VPC và security group có từ <code>VSC</code> , private subnet, đảm bảo không có public IP</h3>
<p><img alt="Untitled" src="/images/part6/6.3.2.-step4.png"></p>
<h3 id="bước-5-cung-cấp-iam-instance-profile-có-từ-vsc-để-cài-đặt-ssm-agent">Bước 5: Cung cấp IAM instance profile có từ <code>VSC</code> để cài đặt SSM agent</h3>
<p><img alt="Untitled" src="/images/part6/6.3.2.-step5.png"></p>
<h3 id="bước-6-chọn-create-instance">Bước 6: Chọn <code>Create instance</code></h3>
<h3 id="bước-7-đợi-tới-khi-instance-status-available">Bước 7: Đợi tới khi instance status <code>Available</code></h3>
<p><img alt="Untitled" src="/images/part6/6.3.2.-step7.png"></p>
<h3 id="bước-8-truy-cập-web-app-vscode-bằng-session-manager-qua-port-forwarding">Bước 8: Truy cập web app VSCode bằng Session Manager qua port forwarding</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#a6e22e">aws</span> <span style="color:#a6e22e">ssm</span> <span style="color:#a6e22e">start</span><span style="color:#f92672">-</span><span style="color:#a6e22e">session</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span><span style="color:#a6e22e">target</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">-</span><span style="color:#ae81ff">06</span><span style="color:#a6e22e">ae65824244ff79b</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span>document<span style="color:#f92672">-</span><span style="color:#a6e22e">name</span> <span style="color:#a6e22e">AWS</span><span style="color:#f92672">-</span><span style="color:#a6e22e">StartPortForwardingSessionToRemoteHost</span> <span style="color:#f92672">^</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">--</span><span style="color:#a6e22e">parameters</span> <span style="color:#a6e22e">host</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;10.0.132.106&#34;</span>,<span style="color:#a6e22e">portNumber</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;8080&#34;</span>,<span style="color:#a6e22e">localPortNumber</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;8080&#34;</span>
</span></span></code></pre></div><p><img alt="Untitled" src="/images/part6/6.3.2.-step8.png"></p>
<p>Truy cập thành công!</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/5-extended-create-an-ami-from-an-instance-and-run-an-instance-from-that-ami/" title="Tạo AMI từ instance và chạy instance từ AMI đó"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/vi/7-connect-vscode-using-ec2_instances_connect-and-aws-systems-manager/" title="Kết nối VScode bằng EC2_Instances_Connect và AWS Systems Manager" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/clipboard.min.js?1723573434"></script>
    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/perfect-scrollbar.min.js?1723573434"></script>
    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/perfect-scrollbar.jquery.min.js?1723573434"></script>
    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/jquery.sticky.js?1723573434"></script>
    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/featherlight.min.js?1723573434"></script>
    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/highlight.pack.js?1723573434"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/modernizr.custom-3.6.0.js?1723573434"></script>
    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/learn.js?1723573434"></script>
    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/js/hugo-learn.js?1723573434"></script>

    <link href="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/mermaid/mermaid.css?1723573434" rel="stylesheet" />
    <script src="/levuxuanan.github.io-REMOTE-DEVELOPMENT-WITH-VS-VSCODE-AND-EC2/mermaid/mermaid.js?1723573434"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');
  function updateImageSources() {
    
    var images = document.querySelectorAll("img");
    
    
    images.forEach(function(image) {
      const fullSrc = image.src;

      
      const url = new URL(fullSrc);
      
        image.src = baseurl.concat(url.pathname);
    });
  }
  updateImageSources()
</script>
  </body>
</html>
